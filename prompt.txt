# Role: Senior Embedded Systems Engineer & IoT Architect

**Project:** Autonomous Forest/Environmental Monitoring Rover with Base Station Reporting System.

**Objective:** 
Design the hardware connections, system architecture, and software logic for a 4WD rover and a Charging/Base Station. The system must monitor for environmental hazards (fire, earthquakes, intruders), perform autonomous navigation, and generate daily reports.

---

### 1. Hardware Inventory & Roles

**A. Rover Unit (Mobile):**
*   **Main Controller:** ESP32-S3 (Handles navigation, sensor data, and logic).
*   **Vision:** ESP32-CAM (Separate board, wired to S3). Used for object/fire/human detection.
*   **Motors:** 4x DC Motors driven by an **L9110S Motor Driver** (4WD).
*   **Connectivity:** SIM800 Module (GSM/GPRS) for immediate alerts.
*   **Positioning:** Neo-6M GPS Module.
*   **Sensors:** 
    *   DS18B20 (Temperature/Fire detection).
    *   Ultrasonic Sensor (Obstacle avoidance).
    *   MPU6050 (IMU for earthquake detection/tilt).
*   **Power:** LiPo Battery Pack (<30% triggers return-to-base), DC Buck Converter (power regulation).
*   **Output:** Buzzer (Audible alerts).

**B. Base/Charging Station (Stationary):**
*   **Processing Unit:** Raspberry Pi Zero (Generates detailed daily reports).
*   **Communication Bridge:** ESP32-C3. 
    *   *Topology:* Connects wirelessly (ESP-NOW/WiFi) to the Rover's ESP32-S3. Connects via UART (Wired) to the Pi Zero.
*   **Display:** LCD Display (Displays charging status and report summary).
*   **Power:** Generic Charger connection.

---

### 2. Functional Requirements & Logic

**A. Navigation & Patrol (The "Optimal Path"):**
*   The rover patrols a forest environment.
*   **Smart Obstacle Avoidance:** If high temperature/fire is detected, the rover must identify "trees" (via Camera) and actively avoid going near them to prevent self-damage.
*   **Return to Base:** If Battery < 30%, the rover calculates the path back to the Charging Station coordinates using GPS and enters "Power Saving Mode" (reduce motor speed, reduce sensor polling rate).

**B. Hazard Detection & Alerts:**
*   **Conditions:** Fire (High Temp + Visual), Earthquake (MPU6050 vibration), or Human Detected (Camera).
*   **Immediate Action:** 
    1. Stop and Sound Buzzer.
    2. Send SMS/Call/Data Alert to Forest Officers via **SIM800**.
    3. Notify the "User App" (Mockup logic required).
*   **"Research Mode":** When a hazard or point of interest is found, the rover stops, captures data (Photo, Temp, GPS, Gyro), and logs it locally until it can sync with the Base Station.

**C. Reporting Pipeline:**
*   **Daily Report:** When the rover docks at the station:
    1. Rover (S3) sends all logged data to Base Station (C3) wirelessly.
    2. C3 forwards data to Pi Zero via UART.
    3. Pi Zero compiles a "Daily Report" (text/PDF/Log) containing path traveled, anomalies detected, and battery stats.
    4. Pi Zero updates the Station LCD with "Report Ready" or status.

---

### 3. Deliverables Required

Please provide the following in your response:

**1. Wiring & Connection Diagrams (Pinout Table):**
*   Provide a detailed table for the **ESP32-S3** connecting to: L9110S, ESP32-CAM (UART connection), SIM800, GPS, Sensors, and MPU6050.
*   Provide a detailed table for the **Base Station**: ESP32-C3 wired to Raspberry Pi Zero and the LCD.

**2. Software Architecture & Logic:**
*   **ESP32-S3 (Rover) Firmware Structure (C++/Arduino):** 
    *   Include the State Machine (Patrol, Research, Alert, Return, Docked).
    *   Include logic for reading the sensors and communicating with the ESP32-CAM.
*   **ESP32-CAM Firmware Structure:** Simple code to process images and send "Object Detected" flags to the S3.
*   **ESP32-C3 (Bridge) Firmware:** Code to receive ESP-NOW data from S3 and pass it to Pi Zero via Serial.
*   **Raspberry Pi Zero (Python Script):** Script to listen to Serial, parse data, and generate a simulated report file.
*   **Forest Officer App Concept:** A basic outline or pseudo-code for how the mobile app handles the notifications.

**3. Power Saving Logic:**
*   Show specifically how to implement the code to slow down motors and sleep sensors when battery drops below 30%.

**4. Special Instructions:**
*   Ensure the code accounts for the L9110S logic.
*   Include the specific library imports needed.
connections:
Here are the detailed connection diagrams and pinout tables based on your specific requirements (ESP32-S3 Rover + Pi Zero/ESP32-C3 Base Station).

1. ROVER UNIT CONNECTIONS
Power Logic:

Battery (LiPo): Connects to the Buck Converter IN.
Buck Converter OUT (Set to 5V): Powers the ESP32-S3 (5V pin), ESP32-CAM (5V pin), L9110S VCC, SIM800 VCC, and Servo/Sensors.
Common Ground: ALL components (Battery, S3, CAM, Driver, SIM800, Sensors) must share a common GND.
A. ESP32-S3 (Main Controller) Pin Map
Component	Component Pin	ESP32-S3 Pin (GPIO)	Notes
L9110S Driver	B-IA (Left Motors)	GPIO 4	PWM Speed Control
B-IB (Left Motors)	GPIO 5	Direction Control
A-IA (Right Motors)	GPIO 6	PWM Speed Control
A-IB (Right Motors)	GPIO 7	Direction Control
ESP32-CAM	U0T (TX)	GPIO 17 (RX)	UART Communication
U0R (RX)	GPIO 18 (TX)	UART Communication
SIM800L Module	TXD	GPIO 16 (RX)	Use Hardware Serial 1
RXD	GPIO 15 (TX)	Use Hardware Serial 1
VCC	Buck Converter 5V	DO NOT power from ESP32 pin
Neo-6M GPS	TX	GPIO 8 (RX)	Use Hardware Serial 2
RX	GPIO 19 (TX)	Use Hardware Serial 2
MPU6050 (IMU)	SDA	GPIO 42	I2C Data
SCL	GPIO 2	I2C Clock
Ultrasonic	Trig	GPIO 12	Trigger Pulse
Echo	GPIO 13	Use 1k/2k Resistor Divider (5V to 3.3V)
DS18B20 Temp	Signal	GPIO 21	Needs 4.7k Pull-up Resistor
Buzzer	Positive (+)	GPIO 48	Active High
Battery Monitor	Positive (+)	GPIO 1 (ADC)	Must use Voltage Divider (Max 3.3V in)
B. ESP32-CAM Wiring (Vision Only)
This board strictly handles image processing and sends "Hazard Detected" signals to the S3.

ESP32-CAM Pin	Connection
5V	Buck Converter 5V
GND	Common Ground
U0T (TX)	Connects to S3 GPIO 17
U0R (RX)	Connects to S3 GPIO 18
2. BASE STATION CONNECTIONS
Power Logic: Powered by a Generic USB Wall Charger (5V).

A. Raspberry Pi Zero (Main Base Computer)
Component	Component Pin	Pi Zero Pin (Physical/BCM)	Notes
ESP32-C3	TX	Pin 10 (GPIO 15 RXD)	Serial Communication
RX	Pin 8 (GPIO 14 TXD)	Serial Communication
LCD Display	SDA	Pin 3 (GPIO 2 SDA)	I2C Display (16x2)
SCL	Pin 5 (GPIO 3 SCL)	I2C Display (16x2)
VCC	Pin 2 (5V)	
Power	USB Port	USB PWR	From Wall Charger
B. ESP32-C3 (WiFi Bridge)
This board receives wireless data from the Rover S3 and passes it to the Pi Zero via wire.

ESP32-C3 Pin	Connection	Notes
5V / 3.3V	Pi Zero 3.3V Pin	Power from Pi Header
GND	Pi Zero GND Pin	Common Ground
TX (GPIO 21)	Pi Zero Pin 10 (RX)	Send data to Pi
RX (GPIO 20)	Pi Zero Pin 8 (TX)	Receive data from Pi
Important Hardware Warnings for this Build:
L9110S & 4 Motors: Since the L9110S is a 2-channel driver, you must wire the two LEFT motors together into the "B" screw terminals, and the two RIGHT motors together into the "A" screw terminals.
Ultrasonic Sensor (5V Logic): The Echo pin sends a 5V signal. The ESP32-S3 is 3.3V logic. You must use a voltage divider (two resistors) on the Echo pin before it goes to the S3 to avoid frying the pin.
SIM800 Power: This module draws spikes of 2Amps. It will fail if powered by the ESP32. It must be connected directly to the Buck Converter output.
Battery Monitoring: To read the battery percentage (<30% logic), you cannot plug the battery directly into the S3. You need a simple voltage divider (e.g., two 10k resistors) to drop the LiPo voltage (approx 12V or 7.4V) down to below 3.3V for the Analog Pin.